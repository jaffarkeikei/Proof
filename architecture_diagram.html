<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Product Requirements Document (PRD)</title>
<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({startOnLoad:true,theme:'default'});
window.addEventListener('load', () => {
    const moduleData = {"config_JavaScript": {"filename": "config_JavaScript.prompt", "priority": 1, "description": "Centralized configuration manager that loads environment variables from .env file and validates required API keys (Rtrvr, Cerebras, ElevenLabs, Grok, Twilio, Toolhouse). Exports typed configuration object with validation errors thrown at startup. Uses dotenv for loading and provides singleton access pattern.", "dependencies": [], "tags": ["backend", "config", "utils"], "filepath": "src/utils/config.js"}, "logger_JavaScript": {"filename": "logger_JavaScript.prompt", "priority": 2, "description": "Winston-based logging module with structured JSON output, multiple transports (console, file), and log levels (error, warn, info, debug). Includes request correlation IDs and timestamps. Used by all agents for consistent logging pattern.", "dependencies": [], "tags": ["backend", "utils", "logging"], "filepath": "src/utils/logger.js"}, "database_JavaScript": {"filename": "database_JavaScript.prompt", "priority": 3, "description": "Better-sqlite3 based database module using synchronous API for performance. Creates tables for reviews, scripts, videos, and pipeline runs. Provides CRUD operations and transaction support. Initializes schema on first run.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt"], "tags": ["backend", "database", "utils"], "filepath": "src/utils/database.js"}, "validation_JavaScript": {"filename": "validation_JavaScript.prompt", "priority": 4, "description": "Zod-based validation schemas for pipeline inputs (company name, review data), API request payloads, and inter-agent data contracts. Provides type-safe validation with detailed error messages. Exports reusable schemas for all data structures.", "dependencies": [], "tags": ["backend", "utils", "validation"], "filepath": "src/utils/validation.js"}, "discovery_agent_JavaScript": {"filename": "discovery_agent_JavaScript.prompt", "priority": 5, "description": "Agent that calls Rtrvr.ai API to scrape reviews from G2, Trustpilot, Reddit, and Twitter/X given a company name or URL. Handles API rate limiting with axios-retry. Returns normalized review array with metadata (platform, author, rating, text, date). Implements error handling and retry logic.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "validation_JavaScript.prompt"], "tags": ["backend", "agent", "rtrvr"], "filepath": "src/agents/discovery.js"}, "analysis_agent_JavaScript": {"filename": "analysis_agent_JavaScript.prompt", "priority": 6, "description": "Agent that sends review array to Cerebras API for fast LLM inference. Uses OpenAI-compatible endpoint to rank reviews by conversion potential, extract key quotes, and identify themes. Returns top 5 reviews with extracted hooks and sentiment scores. Handles API errors and rate limiting.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "validation_JavaScript.prompt"], "tags": ["backend", "agent", "cerebras", "ai"], "filepath": "src/agents/analysis.js"}, "permission_agent_JavaScript": {"filename": "permission_agent_JavaScript.prompt", "priority": 7, "description": "Agent that uses Twilio SMS API to send permission requests to review authors. Generates consent links with unique tokens and sends personalized SMS messages. Tracks consent status in database. Handles phone number validation and Twilio API errors. For demo, provides simulation mode.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "database_JavaScript.prompt", "validation_JavaScript.prompt"], "tags": ["backend", "agent", "twilio", "sms"], "filepath": "src/agents/permission.js"}, "generation_agent_JavaScript": {"filename": "generation_agent_JavaScript.prompt", "priority": 8, "description": "Agent that generates video content from approved reviews. First creates voiceover using ElevenLabs text-to-speech API, then generates video using Grok video API with script and visuals. Produces 3-5 variations per review with different angles (problem/solution/transformation). Saves video files to local storage and metadata to database.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "database_JavaScript.prompt", "validation_JavaScript.prompt"], "tags": ["backend", "agent", "elevenlabs", "grok", "ai"], "filepath": "src/agents/generation.js"}, "distribution_agent_JavaScript": {"filename": "distribution_agent_JavaScript.prompt", "priority": 9, "description": "Agent that uses Toolhouse.ai platform to schedule and post videos to LinkedIn, Twitter/X, and other social platforms. Handles authentication, platform-specific formatting, and post scheduling. Returns post URLs and initial engagement metrics. Implements retry logic for failed posts.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "database_JavaScript.prompt", "validation_JavaScript.prompt"], "tags": ["backend", "agent", "toolhouse", "social"], "filepath": "src/agents/distribution.js"}, "pipeline_orchestrator_JavaScript": {"filename": "pipeline_orchestrator_JavaScript.prompt", "priority": 10, "description": "Main orchestration module that executes agents in order: Discovery \u2192 Analysis \u2192 Permission \u2192 Generation \u2192 Distribution. Manages pipeline state, error handling, and resumability. Emits progress events via EventEmitter for SSE updates. Persists pipeline runs to database. Implements fail-fast error handling with manual retry capability.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "database_JavaScript.prompt", "validation_JavaScript.prompt", "discovery_agent_JavaScript.prompt", "analysis_agent_JavaScript.prompt", "permission_agent_JavaScript.prompt", "generation_agent_JavaScript.prompt", "distribution_agent_JavaScript.prompt"], "tags": ["backend", "orchestrator", "pipeline"], "filepath": "src/pipeline/orchestrator.js"}, "api_routes_JavaScript": {"filename": "api_routes_JavaScript.prompt", "priority": 11, "description": "Express.js router defining REST API endpoints: POST /api/pipeline/start, GET /api/pipeline/:runId/status, GET /api/pipeline/:runId/sse for real-time updates. Implements request validation, error handling middleware, and CORS. Routes calls to orchestrator and returns JSON responses.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "validation_JavaScript.prompt", "pipeline_orchestrator_JavaScript.prompt"], "tags": ["backend", "api", "express"], "filepath": "src/api/routes.js"}, "server_JavaScript": {"filename": "server_JavaScript.prompt", "priority": 12, "description": "Main Express application entry point. Sets up middleware (CORS, body-parser, morgan logging), mounts API routes, configures error handling middleware, and starts HTTP server on port 3001. Includes graceful shutdown handling and database connection initialization.", "dependencies": ["config_JavaScript.prompt", "logger_JavaScript.prompt", "database_JavaScript.prompt", "api_routes_JavaScript.prompt"], "tags": ["backend", "server", "express"], "filepath": "src/server.js"}, "root_layout_TypeScriptReact": {"filename": "root_layout_TypeScriptReact.prompt", "priority": 13, "description": "Next.js 15 App Router root layout component. Sets up HTML structure, imports global CSS, configures metadata (title, description), and provides React Query provider for data fetching. Uses Inter font from next/font/google.", "dependencies": [], "tags": ["frontend", "nextjs", "layout"], "filepath": "app/layout.tsx"}, "dashboard_page_TypeScriptReact": {"filename": "dashboard_page_TypeScriptReact.prompt", "priority": 14, "description": "Main dashboard page with pipeline control form (company name input, start button), real-time progress visualization using SSE connection, and video preview cards. Shows agent execution stages with status indicators. Uses React hooks for state management and EventSource for SSE. Client component for interactivity.", "dependencies": ["root_layout_TypeScriptReact.prompt"], "tags": ["frontend", "nextjs", "page"], "filepath": "app/page.tsx"}, "pipeline_component_TypeScriptReact": {"filename": "pipeline_component_TypeScriptReact.prompt", "priority": 15, "description": "React component that renders pipeline stages (Discovery, Analysis, Permission, Generation, Distribution) with status indicators (pending, in-progress, completed, error). Shows progress bar, agent-specific status messages, and estimated time remaining. Receives pipeline status as props and updates in real-time.", "dependencies": [], "tags": ["frontend", "component", "ui"], "filepath": "app/components/Pipeline.tsx"}, "video_card_component_TypeScriptReact": {"filename": "video_card_component_TypeScriptReact.prompt", "priority": 16, "description": "React component that renders video preview card with thumbnail, title, duration, platform badges (TikTok, LinkedIn, Instagram), and download/share buttons. Shows generation status and allows selecting videos for distribution. Uses HTML5 video element with controls.", "dependencies": [], "tags": ["frontend", "component", "ui"], "filepath": "app/components/VideoCard.tsx"}};
    
    // Add hover listeners to all nodes
    setTimeout(() => {
        const nodes = document.querySelectorAll('.node');
        nodes.forEach(node => {
            const text = node.querySelector('.nodeLabel');
            if (!text) return;
            
            const nodeText = text.textContent.trim();
            const moduleId = nodeText.split(' ')[0];
            const data = moduleData[moduleId];
            
            if (data) {
                node.style.cursor = 'pointer';
                
                node.addEventListener('mouseenter', (e) => {
                    showTooltip(e, data);
                });
                
                node.addEventListener('mouseleave', () => {
                    hideTooltip();
                });
            }
        });
    }, 500);
});
function showTooltip(e, data) {
    hideTooltip();
    
    const tooltip = document.createElement('div');
    tooltip.id = 'module-tooltip';
    tooltip.innerHTML = `
        <div style="font-weight:600;margin-bottom:8px;font-size:1.1em;">${data.filename}</div>
        <div style="margin-bottom:6px;"><strong>Priority:</strong> ${data.priority}</div>
        <div style="margin-bottom:6px;"><strong>Path:</strong> ${data.filepath}</div>
        <div style="margin-bottom:6px;"><strong>Tags:</strong> ${data.tags.join(', ')}</div>
        <div style="margin-bottom:6px;"><strong>Dependencies:</strong> ${data.dependencies.length > 0 ? data.dependencies.join(', ') : 'None'}</div>
        <div style="margin-top:8px;padding-top:8px;border-top:1px solid #ddd;font-size:0.9em;color:#444;">${data.description}</div>
    `;
    
    document.body.appendChild(tooltip);
    
    const rect = e.target.closest('.node').getBoundingClientRect();
    tooltip.style.left = rect.right + 10 + 'px';
    tooltip.style.top = rect.top + window.scrollY + 'px';
}
function hideTooltip() {
    const existing = document.getElementById('module-tooltip');
    if (existing) existing.remove();
}
</script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#fff;color:#000;padding:2rem;max-width:1400px;margin:0 auto}
h1{font-size:2rem;font-weight:600;margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #000}
.diagram{border:1px solid #000;padding:2rem;margin:2rem 0;overflow-x:auto;position:relative}
.mermaid{display:flex;justify-content:center}
#module-tooltip{
    position:absolute;
    background:#fff;
    border:2px solid #000;
    padding:1rem;
    max-width:400px;
    z-index:1000;
    box-shadow:4px 4px 0 rgba(0,0,0,0.1);
    font-size:0.9rem;
    line-height:1.5;
}
.node{transition:opacity 0.2s}
.node:hover{opacity:0.8}
</style></head><body>
<h1>Product Requirements Document (PRD)</h1>
<div class="diagram"><pre class="mermaid">flowchart TB
        PRD["Product Requirements Document (PRD)"]
    
    subgraph Frontend
        root_layout_TypeScriptReact["root_layout_TypeScriptReact (13)"]
        dashboard_page_TypeScriptReact["dashboard_page_TypeScriptReact (14)"]
        pipeline_component_TypeScriptReact["pipeline_component_TypeScriptReact (15)"]
        video_card_component_TypeScriptReact["video_card_component_TypeScriptReact (16)"]
    end
    
    subgraph Backend
        config_JavaScript["config_JavaScript (1)"]
        logger_JavaScript["logger_JavaScript (2)"]
        database_JavaScript["database_JavaScript (3)"]
        validation_JavaScript["validation_JavaScript (4)"]
        discovery_agent_JavaScript["discovery_agent_JavaScript (5)"]
        analysis_agent_JavaScript["analysis_agent_JavaScript (6)"]
        permission_agent_JavaScript["permission_agent_JavaScript (7)"]
        generation_agent_JavaScript["generation_agent_JavaScript (8)"]
        distribution_agent_JavaScript["distribution_agent_JavaScript (9)"]
        pipeline_orchestrator_JavaScript["pipeline_orchestrator_JavaScript (10)"]
        api_routes_JavaScript["api_routes_JavaScript (11)"]
        server_JavaScript["server_JavaScript (12)"]
    end
    
    PRD --> Frontend
    PRD --> Backend

    database_JavaScript -->|uses| config_JavaScript
    database_JavaScript -->|uses| logger_JavaScript
    discovery_agent_JavaScript -->|uses| config_JavaScript
    discovery_agent_JavaScript -->|uses| logger_JavaScript
    discovery_agent_JavaScript -->|uses| validation_JavaScript
    analysis_agent_JavaScript -->|uses| config_JavaScript
    analysis_agent_JavaScript -->|uses| logger_JavaScript
    analysis_agent_JavaScript -->|uses| validation_JavaScript
    permission_agent_JavaScript -->|uses| config_JavaScript
    permission_agent_JavaScript -->|uses| logger_JavaScript
    permission_agent_JavaScript -->|uses| database_JavaScript
    permission_agent_JavaScript -->|uses| validation_JavaScript
    generation_agent_JavaScript -->|uses| config_JavaScript
    generation_agent_JavaScript -->|uses| logger_JavaScript
    generation_agent_JavaScript -->|uses| database_JavaScript
    generation_agent_JavaScript -->|uses| validation_JavaScript
    distribution_agent_JavaScript -->|uses| config_JavaScript
    distribution_agent_JavaScript -->|uses| logger_JavaScript
    distribution_agent_JavaScript -->|uses| database_JavaScript
    distribution_agent_JavaScript -->|uses| validation_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| config_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| logger_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| database_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| validation_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| discovery_agent_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| analysis_agent_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| permission_agent_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| generation_agent_JavaScript
    pipeline_orchestrator_JavaScript -->|uses| distribution_agent_JavaScript
    api_routes_JavaScript -->|uses| config_JavaScript
    api_routes_JavaScript -->|uses| logger_JavaScript
    api_routes_JavaScript -->|uses| validation_JavaScript
    api_routes_JavaScript -->|uses| pipeline_orchestrator_JavaScript
    server_JavaScript -->|uses| config_JavaScript
    server_JavaScript -->|uses| logger_JavaScript
    server_JavaScript -->|uses| database_JavaScript
    server_JavaScript -->|uses| api_routes_JavaScript
    dashboard_page_TypeScriptReact -->|uses| root_layout_TypeScriptReact
    
    classDef frontend fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef backend fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef shared fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef system fill:#E0E0E0,stroke:#616161,stroke-width:3px
    
    class root_layout_TypeScriptReact,dashboard_page_TypeScriptReact,pipeline_component_TypeScriptReact,video_card_component_TypeScriptReact frontend
    class config_JavaScript,logger_JavaScript,database_JavaScript,validation_JavaScript,discovery_agent_JavaScript,analysis_agent_JavaScript,permission_agent_JavaScript,generation_agent_JavaScript,distribution_agent_JavaScript,pipeline_orchestrator_JavaScript,api_routes_JavaScript,server_JavaScript backend
    class PRD system</pre></div>
</body></html>